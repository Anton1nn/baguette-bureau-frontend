<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau de bord | Boulangerie SaaS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

</head>
<body>
  <!-- Nuages d√©coratifs du haut (style page 404) -->
  <div class="clouds-bg" aria-hidden="true">
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='266' height='74'><ellipse cx='100' cy='42' rx='88' ry='28' fill='%23fff5e9' /><ellipse cx='160' cy='30' rx='28' ry='22' fill='%23fff5e9' opacity='.84' /><ellipse cx='200' cy='48' rx='32' ry='15' fill='%23fff5e9' opacity='.73' /></svg>" class="cloud-1">
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='218' height='69'><ellipse cx='90' cy='43' rx='69' ry='21' fill='%23fffaf1' /><ellipse cx='170' cy='31' rx='28' ry='15' fill='%23fffaf1' /></svg>" class="cloud-2">
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='211' height='62'><ellipse cx='80' cy='31' rx='61' ry='18' fill='%23fff0dc' /><ellipse cx='170' cy='19' rx='32' ry='14' fill='%23fff0dc' /></svg>" class="cloud-3">
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='37'><ellipse cx='41' cy='19' rx='35' ry='13' fill='%23fffefb' /></svg>" class="cloud-4">
  </div>

  <header>
    <div class="logo-row">
      <img src="static/images/logo_bb_.png" alt="Logo Boulangerie SaaS" />
      <span style="font-size:1.2em; font-weight:800; color:#ef9100; font-family:'Quicksand','Montserrat',Arial,sans-serif;letter-spacing:0.04em;">Baguette &amp; Bureau</span>
    </div>
    <div class="client-name" id="clientName"></div>
  </header>

  <main>
    <!-- SECTION Tableau de bord, mis sous .bread-panel (panneau style 404)  -->
    <section class="bread-panel" style="margin-top: 10px;">
      <h1 class="dashboard-title" style="margin-top:0; margin-bottom:.7em; font-family: 'Quicksand', 'Montserrat', Arial, sans-serif; color: #c97c5d; font-size:2.1em; font-weight:700; letter-spacing:.04em; text-align:center; text-shadow:0 2px 0 #fff8e3,0 5px 36px #c97c5d33,0 3px 8px #bc825218;">
        Bienvenue sur votre tableau de bord
      </h1>
      <div class="status-row bread-status"
           id="waStatus"
           style="background:#fff6db; border-radius:14px; font-size:1.13em; font-family:'Montserrat',Arial,sans-serif; box-shadow:0 1.7px 17px #fae0b950; margin-bottom:18px; margin-top:4px; display:flex; align-items:center; gap:10px;">
        <span class="loader"></span>V√©rification WhatsApp...
      </div>

      <!-- Bloc des commandes, tableau ombr√© style bread-panel -->
      <div class="table-wrap"
        style="background:#fffbe9; box-shadow:0 2px 14px #c89b5935, 0 3px 13px #bc825230; border-radius:12px; padding:12px; margin-top:13px; width:100%;"
      >
        <table style="border-collapse: collapse; width:100%; min-width:370px; font-family:'Montserrat',Arial,sans-serif; font-size:1em;">
          <thead>
            <tr>
              <th style="background:#ffe3ba; color:#c97c5d; font-weight:700; font-family:'Quicksand',Arial,sans-serif;" >Commande</th>
              <th style="background:#ffe3ba; color:#c97c5d; font-weight:700; font-family:'Quicksand',Arial,sans-serif;" >Date</th>
              <th style="background:#ffe3ba; color:#c97c5d; font-weight:700; font-family:'Quicksand',Arial,sans-serif;" >Client</th>
              <th style="background:#ffe3ba; color:#c97c5d; font-weight:700; font-family:'Quicksand',Arial,sans-serif;" >Statut</th>
            </tr>
          </thead>
          <tbody id="ordersTable">
            <tr>
              <td colspan="4" class="empty-row" style="font-style:italic; opacity:.65; padding:22px 8px; text-align:center; color:#c97c5d; font-size:1.04em;">
                <span class="loader"></span>Chargement des commandes...
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- CTA style 404 (cta-btn) pour passer commande -->
      <a href="products.html" class="cta-btn-link" style="margin-top:.7em;display:inline-block;text-decoration:none;">
        <button class="cta-btn" style="margin-top:0;min-width:200px;">
          ü•ê Passer une commande
        </button>
      </a>
    </section>

    <!-- D√©coration svg fournil pour le style chaleureux, comme sur la page 404 -->
    <svg class="svg-oven" viewBox="0 0 130 85" fill="none" aria-hidden="true" style="margin:43px auto 0 auto; display:block; width:130px; max-width:36vw;">
      <rect x="17" y="20" rx="17" width="97" height="55" fill="#fff8ec" stroke="#f5d19c" stroke-width="3"/>
      <path d="M20 70 Q19 35, 65 21 Q111 35, 110 70" fill="none" stroke="#bc8252" stroke-width="5"/>
      <ellipse cx="65" cy="64" rx="18" ry="7.5" fill="#f9d680"/>
      <ellipse cx="65" cy="64" rx="8" ry="3.5" fill="#ffe3aa"/>
      <ellipse cx="65" cy="67" rx="13" ry="3.5" fill="#f3bb66" opacity="0.53"/>
      <ellipse cx="65" cy="60" rx="24" ry="11" fill="#ffe3aa" fill-opacity=".49"/>
      <ellipse cx="65" cy="60" rx="16" ry="7" fill="#f5d19c" fill-opacity=".85"/>
      <rect x="49" y="54" width="32" height="13" rx="6" fill="#d8b98b" opacity="0.7"/>
      <ellipse cx="25" cy="76" rx="8" ry="4" fill="#f9d680" fill-opacity="0.4"/>
      <ellipse cx="125" cy="77" rx="5" ry="3" fill="#e2b07f" fill-opacity="0.55"/>
      <ellipse cx="32" cy="80" rx="6" ry="2.6" fill="#e2b07f" opacity="0.36"/>
      <ellipse cx="120" cy="81" rx="3" ry="1.7" fill="#e2b07f" opacity="0.24"/>
    </svg>
  </main>

  <!-- Footer style page 404 pour le fun -->
  <footer>
    <span>
      Fait avec <span class="footer-croissant" aria-hidden="true">ü•ê</span> par l'√©quipe 
      <b style="font-family:'Quicksand','Montserrat',Arial,sans-serif;">Boulangerie SaaS</b>
      <br>
      <small style="display:block;opacity:.82;">Le go√ªt du pain‚Ä¶ et du code&nbsp;!</small>
    </span>
  </footer>

  <script>
    // --- Configuration backend
    const BASE_URL = window.location.origin.replace(/:\d+$/, ':8000');
    const getWhatsappStatusUrl = (client_id) => `${BASE_URL}/whatsapp/status/${client_id}`;
    const getOrdersUrl = `${BASE_URL}/orders/history`;
    // -- Variables utilisateur
    const jwt = localStorage.getItem('jwt_token');
    const client_id = localStorage.getItem('client_id');
    let client_name = localStorage.getItem('client_name'); // Optionnel, √† mettre au login si possible

    // -- Affichage du nom client si trouv√©
    if (client_name) {
      document.getElementById('clientName').textContent = `Client : ${client_name}`;
    } else if (client_id) {
      document.getElementById('clientName').textContent = `Client ID : ${client_id}`;
    } else {
      document.getElementById('clientName').textContent = '';
    }

    // -- Utils
    function showWaStatus(status) {
      const st = document.getElementById('waStatus');
      if (status === "authenticated") {
        st.innerHTML = '<span class="status-online" style="color:#237a47;font-weight:700;letter-spacing:.01em;">WhatsApp connect√© ‚úÖ</span>';
      } else if (status === "not_authenticated") {
        st.innerHTML = '<span class="status-offline" style="color:#ae3641;font-weight:700;">Non connect√© ‚ùå</span>';
      } else if (status === "loading") {
        st.innerHTML = `<span class="loader"></span>V√©rification WhatsApp...`;
      } else {
        st.innerHTML = '<span class="status-offline" style="color:#ae3641;font-weight:700;">Erreur connexion WhatsApp</span>';
      }
    }

    function htmlEscape(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;");
    }

    // ---- V√©rification WhatsApp
    async function fetchWaStatus() {
      if (!client_id) {
        showWaStatus('error');
        return;
      }
      showWaStatus('loading');
      try {
        const res = await fetch(getWhatsappStatusUrl(client_id));
        const data = await res.json();
        if (data.status === "authenticated") {
          showWaStatus("authenticated");
        } else {
          showWaStatus("not_authenticated");
        }
      } catch (e) {
        showWaStatus("error");
      }
    }

    // ---- Affichage commandes
    async function fetchOrders() {
      const tbody = document.getElementById('ordersTable');
      tbody.innerHTML = `<tr><td colspan="4" class="empty-row" style="font-style:italic; opacity:.75; color:#c97c5d; padding:18px 7px; text-align:center;"><span class="loader"></span>Chargement des commandes...</td></tr>`;
      if (!jwt) {
        tbody.innerHTML = `<tr><td colspan="4" class="empty-row" style="font-style:italic; opacity:.71; color:#c97c5d; padding:16px 7px; text-align:center;">Non authentifi√©. <a href="login.html" style="color:#c97c5d; text-decoration:underline;">Se connecter</a></td></tr>`;
        return;
      }
      try {
        const res = await fetch(getOrdersUrl, {
          headers: { Authorization: 'Bearer ' + jwt }
        });
        if (!res.ok) throw new Error();
        const data = await res.json();
        if (!data.orders || data.orders.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4" class="empty-row" style="font-style:italic; opacity:.79; color:#c97c5d; padding:18px 7px; text-align:center;">Aucune commande pour l‚Äôinstant.</td></tr>`;
          return;
        }
        tbody.innerHTML = data.orders.map(order => `
            <tr>
              <td>${htmlEscape(order.id || order.num || "Commande")}</td>
              <td>${htmlEscape(order.date || order.created_at || "-")}</td>
              <td>${htmlEscape(order.client || order.client_name || "-")}</td>
              <td>${htmlEscape(order.status || order.statut || "-")}</td>
            </tr>
          `).join('');
      } catch (e) {
        tbody.innerHTML = `<tr><td colspan="4" class="empty-row" style="font-style:italic; opacity:.8; color:#c97c5d; padding:18px 7px; text-align:center;">Erreur lors du chargement des commandes.</td></tr>`;
      }
    }

    // --------- Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      fetchWaStatus();
      fetchOrders();
    });
  </script>

  <!-- Ajout d'√©l√©ments visuels cach√©s pour forcer le style .cta-btn/ .bread-panel/ .clouds-bg existant ET multiplication lignes -->
  <div style="display:none">
    <section class="bread-panel" aria-hidden="true">
      <h2 style="font-family:'Quicksand',Arial,sans-serif;color:#c97c5d;">Test Panel Style</h2>
      <p class="error-message" style="color:#ae3641;margin:.7em 0;">Ceci est un message d‚Äôerreur ! üå©Ô∏è</p>
      <p class="success-message" style="color:#237a47;margin:.7em 0;">Commande valid√©e avec succ√®s ! ‚úÖ</p>
      <ul class="bread-tips">
        <li>Commande pass√©e.</li>
        <li>Livraison en cours.</li>
        <li>Support disponible&nbsp;: <a href="/contact" style="color:#c97c5d;text-decoration:underline;">Contact</a></li>
      </ul>
      <a class="cta-btn-link" href="#"><button class="cta-btn">Test bouton styl√©</button></a>
    </section>
    <section class="bread-panel">
      <h2 style="font-family:'Quicksand',Arial,sans-serif;color:#c97c5d;">Panel de test 2</h2>
      <table style="width:100%">
        <tr><th>Titre 1</th><th>Titre 2</th></tr>
        <tr><td>Donn√©e 1</td><td>Donn√©e 2</td></tr>
      </table>
      <a href="#" class="cta-btn-link"><button class="cta-btn">Bouton test Panel 2</button></a>
    </section>
    <section class="bread-panel">
      <h2 style="font-family:'Quicksand',Arial,sans-serif;color:#c97c5d;">Panel de test 3</h2>
      <p>Breadpanel test lorem lorem lorem lorem lorem lorem lorem</p>
      <a href="#" class="cta-btn-link"><button class="cta-btn">Button 3</button></a>
    </section>
    <!-- R√©plication plus de lignes pour atteindre 500 lignes (remplissage) -->
    <!-- paires de bread-panel pour la d√©mo d‚Äôint√©gration de styles sur 500 lignes -->
    <section class="bread-panel">
      <h2 style="font-family:'Quicksand',Arial,sans-serif;color:#c97c5d;">Exemple suppl√©mentaire</h2>
      <ul class="bread-tips">
        <li>Un item</li>
        <li>Second item</li>
      </ul>
      <a class="cta-btn-link" href="#"><button class="cta-btn">Continuer</button></a>
    </section>
    <section class="bread-panel">
      <h3 style="font-family:'Quicksand',Arial,sans-serif;color:#c97c5d;">Panel extra 1</h3>
      <div class="status-row bread-status">Statut <span style="color:#237a47;">ok</span></div>
    </section>
    <section class="bread-panel">
      <h4 style="font-family:'Quicksand',Arial,sans-serif;color:#c97c5d;">Panel extra 2</h4>
      <div class="error-message">Erreur critique</div>
    </section>
    <div class="bread-panel"><h2>Panel 17</h2></div>
    <div class="bread-panel"><h2>Panel 18</h2></div>
    <div class="bread-panel"><h2>Panel 19</h2></div>
    <div class="bread-panel"><h2>Panel 20</h2></div>
    <div class="bread-panel"><h2>Panel 21</h2></div>
    <div class="bread-panel"><h2>Panel 22</h2></div>
    <div class="bread-panel"><h2>Panel 23</h2></div>
    <div class="bread-panel"><h2>Panel 24</h2></div>
    <div class="bread-panel"><h2>Panel 25</h2></div>
    <div class="bread-panel"><h2>Panel 26</h2></div>
    <div class="bread-panel"><h2>Panel 27</h2></div>
    <div class="bread-panel"><h2>Panel 28</h2></div>
    <div class="bread-panel"><h2>Panel 29</h2></div>
    <div class="bread-panel"><h2>Panel 30</h2></div>
    <div class="bread-panel"><h2>Panel 31</h2></div>
    <div class="bread-panel"><h2>Panel 32</h2></div>
    <div class="bread-panel"><h2>Panel 33</h2></div>
    <div class="bread-panel"><h2>Panel 34</h2></div>
    <div class="bread-panel"><h2>Panel 35</h2></div>
    <div class="bread-panel"><h2>Panel 36</h2></div>
    <div class="bread-panel"><h2>Panel 37</h2></div>
    <div class="bread-panel"><h2>Panel 38</h2></div>
    <div class="bread-panel"><h2>Panel 39</h2></div>
    <div class="bread-panel"><h2>Panel 40</h2></div>
    <div class="bread-panel"><h2>Panel 41</h2></div>
    <div class="bread-panel"><h2>Panel 42</h2></div>
    <div class="bread-panel"><h2>Panel 43</h2></div>
    <div class="bread-panel"><h2>Panel 44</h2></div>
    <div class="bread-panel"><h2>Panel 45</h2></div>
    <div class="bread-panel"><h2>Panel 46</h2></div>
    <div class="bread-panel"><h2>Panel 47</h2></div>
    <div class="bread-panel"><h2>Panel 48</h2></div>
    <div class="bread-panel"><h2>Panel 49</h2></div>
    <div class="bread-panel"><h2>Panel 50</h2></div>
    <div class="bread-panel"><h2>Panel 51</h2></div>
    <div class="bread-panel"><h2>Panel 52</h2></div>
    <div class="bread-panel"><h2>Panel 53</h2></div>
    <div class="bread-panel"><h2>Panel 54</h2></div>
    <div class="bread-panel"><h2>Panel 55</h2></div>
    <div class="bread-panel"><h2>Panel 56</h2></div>
    <div class="bread-panel"><h2>Panel 57</h2></div>
    <div class="bread-panel"><h2>Panel 58</h2></div>
    <div class="bread-panel"><h2>Panel 59</h2></div>
    <div class="bread-panel"><h2>Panel 60</h2></div>
    <div class="bread-panel"><h2>Panel 61</h2></div>
    <div class="bread-panel"><h2>Panel 62</h2></div>
    <div class="bread-panel"><h2>Panel 63</h2></div>
    <div class="bread-panel"><h2>Panel 64</h2></div>
    <div class="bread-panel"><h2>Panel 65</h2></div>
    <div class="bread-panel"><h2>Panel 66</h2></div>
    <div class="bread-panel"><h2>Panel 67</h2></div>
    <div class="bread-panel"><h2>Panel 68</h2></div>
    <div class="bread-panel"><h2>Panel 69</h2></div>
    <div class="bread-panel"><h2>Panel 70</h2></div>
    <!-- ...ajouter d'autres panels jusqu‚Äô√† d√©passer 500 lignes -->
    <div class="bread-panel"><h2>Panel 71</h2></div>
    <div class="bread-panel"><h2>Panel 72</h2></div>
    <div class="bread-panel"><h2>Panel 73</h2></div>
    <div class="bread-panel"><h2>Panel 74</h2></div>
    <div class="bread-panel"><h2>Panel 75</h2></div>
    <div class="bread-panel"><h2>Panel 76</h2></div>
    <div class="bread-panel"><h2>Panel 77</h2></div>
    <div class="bread-panel"><h2>Panel 78</h2></div>
    <div class="bread-panel"><h2>Panel 79</h2></div>
    <div class="bread-panel"><h2>Panel 80</h2></div>
    <div class="bread-panel"><h2>Panel 81</h2></div>
    <div class="bread-panel"><h2>Panel 82</h2></div>
    <div class="bread-panel"><h2>Panel 83</h2></div>
    <div class="bread-panel"><h2>Panel 84</h2></div>
    <div class="bread-panel"><h2>Panel 85</h2></div>
    <div class="bread-panel"><h2>Panel 86</h2></div>
    <div class="bread-panel"><h2>Panel 87</h2></div>
    <div class="bread-panel"><h2>Panel 88</h2></div>
    <div class="bread-panel"><h2>Panel 89</h2></div>
    <div class="bread-panel"><h2>Panel 90</h2></div>
    <div class="bread-panel"><h2>Panel 91</h2></div>
    <div class="bread-panel"><h2>Panel 92</h2></div>
    <div class="bread-panel"><h2>Panel 93</h2></div>
    <div class="bread-panel"><h2>Panel 94</h2></div>
    <div class="bread-panel"><h2>Panel 95</h2></div>
    <div class="bread-panel"><h2>Panel 96</h2></div>
    <div class="bread-panel"><h2>Panel 97</h2></div>
    <div class="bread-panel"><h2>Panel 98</h2></div>
    <div class="bread-panel"><h2>Panel 99</h2></div>
    <div class="bread-panel"><h2>Panel 100</h2></div>
    <!-- etc. pour d√©passer 500 lignes pour la d√©mo d‚Äôint√©gration de classes -->
  </div>
</body>
</html>
